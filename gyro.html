<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>Pointer 2</title>
</head>

<body>
    <div id="output"></div>
    <script>
        var socket = io.connect();

        let throttle = false;
        let throttletickrate = 128;

        let gyroval = {
            alpha: 0,
            beta: 0,
            gamma: 1,
        };

        if (window.DeviceOrientationEvent) {
            //password = prompt("Password :)")
        } else {
            alert("Sorry, your browser doesn't support Device Orientation");
        }

        window.addEventListener("deviceorientation", handleOrientation, true);

        function handleOrientation(event) {
            if (!throttle) {
                gyroval.alpha = Math.floor(event.alpha * 100) / 100;
                gyroval.beta = Math.floor(event.beta * 100) / 100;
                gyroval.gamma = Math.floor(event.gamma * 100) / 100;

                //console.log(absolute + " / " + alpha + " / " + beta + " / " + gamma);
                document.getElementById("output").innerHTML = "a: " + gyroval.alpha + " <br>b: " + gyroval.beta + " <br>g: " + gyroval.gamma;

                moveMouse();

                throttle = true;
                setTimeout(function() {
                    throttle = false;
                }, 1000 / throttletickrate);
            }
        }

        function moveMouse() {
            socket.emit("gyro.moveMouse", gyroval);
        }
    </script>
</body>

</html>